<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">

	// Load the Visualization API and the piechart package.
	google.load('visualization', '1.0', {'packages':['corechart','table']});

	// Set a callback to run when the Google Visualization API is loaded.
	google.setOnLoadCallback(drawChart);


	function drawChart() {

	    var opt = {
	      title:'Vista general',
	      vAxis: {title: "Likes"},
	      hAxis: {title: "Competidores"},
	      seriesType: "bars",
	      series: {1: {type: "line"}},
	      animation:{
	        duration: 1500,
	        easing: 'out'
	      },
          vAxis: {minValue:0, maxValue:<%= @max_value %>}
	    };

	    var opt2 = {
				    title : 'Vista general',
				    vAxis: {title: "Likes"},
				    hAxis: {title: "Competidores"},
				    seriesType: "bars",
				    series: {1: {type: "line"}},
      				vAxis: {minValue:0, maxValue:<%= @max_value %>}
				  };

	
	   // Some raw data (not necessarily accurate)
	    var rowDataNil = <%= raw @data_nil %>;
		var rowData = <%= raw @data %>;
	
	    // Create and populate the data tables.
	    var data = [];
	    data[0] = google.visualization.arrayToDataTable(rowDataNil);
	    data[1] = google.visualization.arrayToDataTable(rowData);

	
	    var current = 0;
	    // Create and draw the visualization.
	    var chart = new google.visualization.ComboChart(document.getElementById('graph_div'));
		var table = new google.visualization.Table(document.getElementById('table'));

		function addSelectListeners()
		{
			google.visualization.events.addListener(table, 'select', function() {
				chart.setSelection(table.getSelection());
			});
	
			google.visualization.events.addListener(chart, 'select', function() {
				table.setSelection(chart.getSelection());
			});
		}

	    function updateDraw(options) {
			chart.draw(data[1], options);
//			table.draw(data[1], {allowHtml: true, showRowNumber: true});
//			addSelectListeners(sel_table, sel_chart);
	    }

		function drawExec(options) {
			chart.draw(data[current], options);
			table.draw(data[1], {allowHtml: true, showRowNumber: true});
	    }

	    current = 0;
	    drawExec(opt);
	    current = 1 - current;
	    drawExec(opt);

		addSelectListeners();

		google.visualization.events.addListener(table, 'sort',
		      function(event) {
		        	data[1].sort([{column: event.column, desc: !event.ascending}]);
					updateDraw(opt2);
		});

  }

</script>

