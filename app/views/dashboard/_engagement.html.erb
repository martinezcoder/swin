<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  // Load the Visualization API and the chart package.
  google.load('visualization', '1', {packages: ['corechart','table']});
</script>
<script type="text/javascript">

	// Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawVisualization);

  function drawVisualization() {
  
   // Some raw data (not necessarily accurate)
	var rowDataNil = <%= raw @data_nil %>;
	var rowData = <%= raw @data %>;

    // Create and populate the data tables.
	var dataTable = [];
    dataTable[0] = google.visualization.arrayToDataTable(rowDataNil);
    dataTable[1] = google.visualization.arrayToDataTable(rowData);
    
	// The table
    var table = new google.visualization.Table(document.getElementById('table'));
  
  	// Likes Chart
  	var dataLikes = []
  	dataLikes[0] = new google.visualization.DataView(dataTable[0]);
  	dataLikes[1] = new google.visualization.DataView(dataTable[1]);
  	// Actives Chart
    var dataActives = [];
    dataActives[0] = new google.visualization.DataView(dataTable[0]);
    dataActives[1] = new google.visualization.DataView(dataTable[1]);


    var chart = new google.visualization.ComboChart(document.getElementById('graph_div'));
    var chart2 = new google.visualization.ComboChart(document.getElementById('graph_div.2'));

	function drawcharts(n) {
		dataLikes[n].setColumns([0, 3, {sourceColumn:2, role:'tooltip',type:'string'}]);
	    chart.draw(dataLikes[n], {title:'', 
	    							colors: ['#0088CC'], 
	    							width: 350, 
	    							height: 200, 
	    							seriesType: "bars", 
	    							animation:{duration: 1500,easing: 'out'}, 
	    							hAxes:[{title:'Competidores'}],
	    							vAxis: {minValue:0, maxValue:<%= @maxim["Me gusta"] %>},
	    							fontSize: 10,
	    							legend: {position: 'top'}
	    							}); 
	
	    dataActives[n].setColumns([0, 4, {sourceColumn:2, role:'tooltip',type:'string'}]);
	    
	    chart2.draw(dataActives[n], {title:'', 
	    							colors: ['#76D4E5'], 
	    							width: 350, 
	    							height: 200, 
	    							seriesType: "bars", 
	    							animation:{duration: 1500,easing: 'out'},
	    							hAxes:[{title:'Competidores'}], 
	    							vAxis: {minValue:0, maxValue:<%= @maxim["Activos"] %>},
	    							// chartArea:{left:"20%",top:20,width:"50%",height:"75%"}
	    							fontSize: 10,
	    							legend: {position: 'top'} // legend: {position: 'top', textStyle: {color: 'blue', fontSize: 16}}
	    							// Try out the new HTML tooltip.
	    							//allowHtml: true,
    								//tooltip: {isHtml: true},
    								//focusTarget: 'category'
	    							});
	}

    function addSelectListeners(chartx)
    {

      google.visualization.events.addListener(table, 'select', function() {
        chartx.setSelection(table.getSelection());
      });
  
    }

    table.draw(dataTable[1], {allowHtml: true});
	drawcharts(0);
	drawcharts(1);

    addSelectListeners(chart);
    addSelectListeners(chart2);

  }



	function drawChart() {

	    var opt = {	
	      title:'Vista general',
	      vAxis: {title: "Likes"},
	      hAxis: {title: "Competidores"},
	      seriesType: "bars",
	      series: {1: {type: "line"}},
	      animation:{
	        duration: 1500,
	        easing: 'out'
	      },
          vAxis: {minValue:0, maxValue:<%= @max_value %>}
	    };

	    var opt2 = {
				    title : 'Vista general',
				    vAxis: {title: "Likes"},
				    hAxis: {title: "Competidores"},
				    seriesType: "bars",
				    series: {1: {type: "line"}},
      				vAxis: {minValue:0, maxValue:<%= @max_value %>}
				  };

	
	   // Some raw data (not necessarily accurate)
	    var rowDataNil = <%= raw @data_nil %>;
		var rowData = <%= raw @data %>;
	
	    // Create and populate the data tables.
	    var data = [];
	    data[0] = google.visualization.arrayToDataTable(rowDataNil);
	    data[1] = google.visualization.arrayToDataTable(rowData);

	
	    var current = 0;
	    // Create and draw the visualization.
	    var chart = new google.visualization.ComboChart(document.getElementById('graph_div'));
		var table = new google.visualization.Table(document.getElementById('table'));

		function addSelectListeners()
		{
			google.visualization.events.addListener(table, 'select', function() {
				chart.setSelection(table.getSelection());
			});
	
			google.visualization.events.addListener(chart, 'select', function() {
				table.setSelection(chart.getSelection());
			});
		}

		function drawExec(current, options) {
			chart.draw(data[current], options);
			table.draw(data[1], {allowHtml: true, showRowNumber: true});
	    }

	    drawExec(0, opt);
	    drawExec(1, opt);

		addSelectListeners();

		google.visualization.events.addListener(table, 'sort',
		      function(event) {
		        	data[1].sort([{column: event.column, desc: !event.ascending}]);
					drawExec(1, opt2);
		});

  }

</script>

