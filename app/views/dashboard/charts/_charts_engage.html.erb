<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  // Load the Visualization API and the chart package.
  google.load('visualization', '1', {packages: ['corechart','table']});
</script>
<script type="text/javascript">

	// Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawVisualization);

  function drawVisualization() {

	function drawTable(tablex, datax) {
		datax.setColumns([0,1,2,3,4]);
		tablex.draw(datax, {allowHtml: true}); //, showRowNumber: true});
	}

	function drawcharts(chartx, datax) {
		datax.setColumns([0, 4]);
	    chartx.draw(datax, options); 
	}

    function addSelectListeners(chartx, tablex)
    {
      google.visualization.events.addListener(tablex, 'select', function() {
        chartx.setSelection(tablex.getSelection());
      });
    }

    var options = {
            seriesType: "bars",
            title:'Engagement (fidelidad de los seguidores)', 
            titleTextStyle: {fontSize: 14},
            colors: ['#0088CC'], 
//            width: 950, 
            height: 200, 
            animation:{duration: 1500,easing: 'out'}, 
            hAxes:[{title:'Competidores'}],
            vAxis: {minValue:0, maxValue:<%= @max %>},
            fontSize: 10,
            legend: {position: 'none', textStyle: {fontSize: 14}},
//            focusTarget: 'category',
            tooltip: {isHtml: true}
            };

   // Some raw data (not necessarily accurate)

	var rowDataA = <%= raw @dataA %>;
	var rowDataB = <%= raw @dataB %>;

    // Create and populate the data tables.
    var dataTableA = new google.visualization.DataTable();
    dataTableA.addColumn('string', 'Id');
    dataTableA.addColumn('string', 'Icono');
    dataTableA.addColumn('string', 'Nombre');
    dataTableA.addColumn('string', 'Tipo');
    dataTableA.addColumn('number', 'Engagement');
    dataTableA.addColumn('string', 'pic');
    dataTableA.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});
    dataTableA.addRows(rowDataA);

    var dataTableB = new google.visualization.DataTable();
    dataTableB.addColumn('string', 'Id');
    dataTableB.addColumn('string', 'minipic');
    dataTableB.addColumn('string', 'Nombre');
    dataTableB.addColumn('string', 'Tipo');
    dataTableB.addColumn('number', 'Engagement');
    dataTableB.addColumn('string', 'pic');
    dataTableB.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});
    dataTableB.addRows(rowDataB);

    var table = new google.visualization.Table(document.getElementById('table'));
    var chart = new google.visualization.ComboChart(document.getElementById('graph_div'));

	var formatter = new google.visualization.NumberFormat({fractionDigits: 0});
	formatter.format(dataTableB, 4);

  	// Data
  	var dataChartA = new google.visualization.DataView(dataTableA);
	drawcharts(chart, dataChartA);

    var dataChartB = new google.visualization.DataView(dataTableB);
    dataChartB.setColumns([0, 4, 6]);
    chart.draw(dataChartB, options);

  	var sub_datatable = new google.visualization.DataView(dataTableB);
	drawTable(table, sub_datatable);

    addSelectListeners(chart, table);

  }

</script>

