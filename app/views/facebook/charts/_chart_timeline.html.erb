<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  // Load the Visualization API and the chart package.
  google.load('visualization', '1', {packages: ['corechart','table']});
</script>
<script type="text/javascript">

	// Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawVisualization);

  function drawVisualization() {

    var options = {
            seriesType: "area",
            //seriesType: "line", curveType: "function",
            title:'Evolución engagement (fidelidad de los seguidores)', 
            titleTextStyle: {fontSize: 14},
            colors: ['#0088CC'], 
            height: 200, 
            animation:{duration: 1500,easing: 'out'}, 
            hAxes:[{title:''}],
            vAxis: {minValue:0, maxValue:<%= @max %>},
            fontSize: 10,
            legend: {position: 'none', textStyle: {fontSize: 14}},
            tooltip: {isHtml: true}
            };

	var rowDataA = <%= raw @dataA %>;
	var rowDataB = <%= raw @dataB %>;

    // Create and populate the data tables.
    var dataTableA = new google.visualization.DataTable();
    dataTableA.addColumn('string', 'Fecha');
    dataTableA.addColumn('number', 'Engagement');
    dataTableA.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});
    dataTableA.addColumn('string', 'Variación');
    dataTableA.addColumn('number', 'Id');
    dataTableA.addRows(rowDataA);

    var dataTableB = new google.visualization.DataTable();
    dataTableB.addColumn('string', 'Fecha');
    dataTableB.addColumn('number', 'Engagement');
    dataTableB.addColumn({'type': 'string', 'role': 'tooltip', 'p': {'html': true}});
    dataTableB.addColumn('string', 'Variación');
    dataTableB.addColumn('number', 'Id');
    dataTableB.addRows(rowDataB);

    var table = new google.visualization.Table(document.getElementById('table'));
    var chart = new google.visualization.ComboChart(document.getElementById('<%= graph %>'));

	var formatter = new google.visualization.NumberFormat({fractionDigits: 0});
	formatter.format(dataTableB, 1);

  	// Data
  	var dataChartA = new google.visualization.DataView(dataTableA);
	dataChartA.setColumns([0, 1]);
	chart.draw(dataChartA, options);

    var dataChartB = new google.visualization.DataView(dataTableB);
    dataChartB.setColumns([0, 1, 2]);
    chart.draw(dataChartB, options);

  	var sub_datatable = new google.visualization.DataView(dataTableB);
	sub_datatable.setColumns([4, 0, 1, 3]);
	table.draw(sub_datatable, {allowHtml: true, sortColumn: 0, sortAscending: false});

	google.visualization.events.addListener(table, 'select', function() {
		chart.setSelection(table.getSelection());
	});
	
	google.visualization.events.addListener(chart, 'select', function() {
		table.setSelection(chart.getSelection());
	});

  }

</script>

